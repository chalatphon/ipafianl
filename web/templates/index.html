<html>
<head>
    <title>Sample app</title>
    <link rel="stylesheet" href="/static/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body>
    <h1>Insert Device Detail</h1>
    <form method="POST" action="/add">
    <input name="ip" placeholder="ip" required />
    <input name="username" placeholder="username" required />
    <input name="password" placeholder="password" required />
    <button type="submit">Add Comment</button>
  </form>

  <h1 class="bg-red-500">Router</h1>
  <ul>
    {% for router in data %}
      <li>
	        <a href="/router/{{ router.ip }}" style="margin-left:8px;">{{ router.ip }}</a> - {{ router.username }}
         <form action="/delete/{{ router._id }}" method="POST" style="display:inline;">
          <button type="submit">Delete</button>
         </form>
      </li>
    {% endfor %}
  </ul>
    <h1>Switch</h1>
    <ul>
    {% for switch in sdata %}
      <li>
	        <a href="/switch/{{ switch.ip }}" style="margin-left:8px;">{{ switch.ip }}</a> - {{ switch.username }}
         <form action="/delete/{{ switch._id }}" method="POST" style="display:inline;">
          <button type="submit">Delete</button>
         </form>
      </li>
    {% endfor %}
  </ul>

</body>
<script>
        // ฟังก์ชันสำหรับดึงข้อมูลใหม่มาอัปเดต
        async function refreshTable() {
            try {
                // ดึงข้อมูลหน้าเว็บปัจจุบันมาใหม่ (จะได้เป็น Text HTML)
                const response = await fetch(window.location.href); 
                const htmlText = await response.text();

                // แปลง Text HTML ให้เป็น Document Object เพื่อให้ค้นหา element ได้
                const parser = new DOMParser();
                const newDoc = parser.parseFromString(htmlText, 'text/html');

                // ค้นหาตารางใหม่จากข้อมูลที่เพิ่งดึงมา
                const newTableContainer = newDoc.getElementById('table-container');

                // นำตารางใหม่ไปแทนที่ตารางเก่า
                if (newTableContainer) {
                    document.getElementById('table-container').innerHTML = newTableContainer.innerHTML;
                }

            } catch (error) {
                console.error('Failed to refresh table:', error);
            }
        }

        // สั่งให้ฟังก์ชัน refreshTable() ทำงานทุก 5 วินาที
        setInterval(refreshTable, 5000); // 5000 มิลลิวินาที = 5 วินาที
    </script>
</html>